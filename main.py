import telebot  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–æ–¥—É–ª—å telebot –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ pyTelegramBotAPI.
from pyowm import OWM  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–æ–¥—É–ª—å OWM (Open Weather Map) –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ pyowm.


def get_location(lat, lon):  # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è URL –∫–∞—Ä—Ç—ã –ø–æ–≥–æ–¥—ã –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —à–∏—Ä–æ—Ç—ã –∏ –¥–æ–ª–≥–æ—Ç—ã.
    url = f"https://yandex.uz/pogoda/maps/nowcast?lat={lat}&lon={lon}&via=hnav&le_lightning=1"  # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º URL —Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏ —à–∏—Ä–æ—Ç–æ–π –∏ –¥–æ–ª–≥–æ—Ç–æ–π.
    return url  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º URL.


def weather(city: str):  # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º –≥–æ—Ä–æ–¥–µ.
    owm = OWM('81bf711240c88ed94fcdabb8f0d86001')  # –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞ OWM, –∏—Å–ø–æ–ª—å–∑—É—è –≤–∞—à API-–∫–ª—é—á.
    mgr = owm.weather_manager()  # –ü–æ–ª—É—á–∞–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–≥–æ–¥—ã.
    observation = mgr.weather_at_place(city)  # –ü–æ–ª—É—á–∞–µ–º –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ –ø–æ–≥–æ–¥–æ–π –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –≥–æ—Ä–æ–¥–µ.
    weather = observation.weather  # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≥–æ–¥–µ –∏–∑ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è.
    location = get_location(observation.location.lat,
                            observation.location.lon)  # –ü–æ–ª—É—á–∞–µ–º URL –∫–∞—Ä—Ç—ã –ø–æ–≥–æ–¥—ã –¥–ª—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –Ω–∞–±–ª—é–¥–µ–Ω–∏—è.
    temperature = weather.temperature("celsius")  # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –≤ –≥—Ä–∞–¥—É—Å–∞—Ö –¶–µ–ª—å—Å–∏—è.
    return temperature, location  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –∏ URL –∫–∞—Ä—Ç—ã –ø–æ–≥–æ–¥—ã.


bot = telebot.TeleBot(
    '6632279379:AAGG6VMmum6XEBmwa_0dyXxq4b6_WWLBS8w')  # –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞ TeleBot, –∏—Å–ø–æ–ª—å–∑—É—è –≤–∞—à API-–∫–ª—é—á.


@bot.message_handler(content_types=['text'])  # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.
def get_text_messages(message):  # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.
    if message.text == '/weather':  # –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Ä–∞–≤–µ–Ω '/weather'...
        bot.send_message(message.from_user.id,
                         "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ì–æ—Ä–æ–¥–∞ üèôÔ∏è")  # ...–ø—Ä–æ—Å–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–≤–µ—Å—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞.
        bot.register_next_step_handler(message,
                                       get_weather)  # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑–æ–≤–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é get_weather.
    else:  # –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ —Ä–∞–≤–µ–Ω '/weather'...
        bot.send_message(message.from_user.id, '–ù–∞–ø–∏—à–∏—Ç–µ ‚òî /weather')  # ...–ø—Ä–æ—Å–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞–ø–∏—Å–∞—Ç—å '/weather'.


def get_weather(message):  # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã.
    city = message.text  # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è –Ω–∞–∑–≤–∞–Ω–∏–µ–º –≥–æ—Ä–æ–¥–∞.
    try:  # –ü—ã—Ç–∞–µ–º—Å—è...
        w = weather(city)  # ...–ø–æ–ª—É—á–∏—Ç—å –ø–æ–≥–æ–¥—É –¥–ª—è –≥–æ—Ä–æ–¥–∞.
        bot.send_message(message.from_user.id, f'–í {city} —Å–µ–π—á–∞—Å {round(w[0]["temp"])} –≥—Ä–∞–¥—É—Å–∞,'
                                               f'—á—É–≤—Å—Ç–≤—É–µ—Ç—å—Å—è –∫–∞–∫ {round(w[0]["feels_like"])} –≥—Ä–∞–¥—É—Å–∞')  # ...–æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ç–µ–∫—É—â–µ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π –∏ –æ—â—É—â–∞–µ–º–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π.
        bot.send_message(message.from_user.id, w[1])  # ...–æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å URL –∫–∞—Ä—Ç—ã –ø–æ–≥–æ–¥—ã.
        bot.send_message(message.from_user.id,
                         "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞")  # ...–ø—Ä–æ—Å–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–≤–µ—Å—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥—Ä—É–≥–æ–≥–æ –≥–æ—Ä–æ–¥–∞.
        bot.register_next_step_handler(message,
                                       get_weather)  # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–Ω–æ–≤–∞ –≤—ã–∑–æ–≤–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é get_weather.
    except Exception:  # –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞...
        bot.send_message(message.from_user.id,
                         '–ü–†–û–ò–ó–û–®–õ–ê –û–®–ò–ë–ö–ê...–¢–ê–ö–û–ì–û –ì–û–†–û–î–ê  –ò–õ–ò –°–¢–†–ê–ù–´ –ù–ï–¢–£ –í –ë–ê–ó–ï, –ü–ê–ü–†–û–ë–£–ô–¢–ï –ï–©–Å –†–ê–ó')  # ...—Å–æ–æ–±—â–∞–µ–º –æ–± —ç—Ç–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
        bot.send_message(message.from_user.id,
                         "–í–í–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞")  # ...–ø—Ä–æ—Å–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–≤–µ—Å—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ —Å–Ω–æ–≤–∞.
        bot.register_next_step_handler(message,
                                       get_weather)  # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–Ω–æ–≤–∞ –≤—ã–∑–æ–≤–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é get_weather.


bot.polling(none_stop=True)  # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞.
